FROM python:3.10-slim

WORKDIR /app

COPY ../raw_data/ ./raw_data/

WORKDIR /app/api

# Copier les fichiers nécessaires
COPY app/api/requirements.txt .
COPY app/api/tests_unitaires/ ./tests_unitaires/
COPY app/api/main.py .
COPY app/api/endpoint/ ./endpoint/
COPY app/api/data/ ./data/
COPY app/api/utils/ ./utils/
COPY app/api/static/ ./static/

# Installer les dépendances
RUN apt-get update && apt-get install -y build-essential
RUN pip install -r requirements.txt
RUN pip install pytest pytest-cov

# Variables d'environnement pour les tests
ENV PYTHONPATH=/app
ENV MLFLOW_TRACKING_URI=http://fake-mlflow:5000

# Ajouter une commande de nettoyage du cache python avant les tests
CMD PYTHONPATH=/app pytest -vv tests_unitaires/